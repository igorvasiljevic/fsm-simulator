let fsm_canvas;window.addEventListener("load",()=>{let e=document.getElementById("download"),t=document.getElementsByClassName("toggle_options_menu")[0],n=document.getElementsByClassName("options_menu")[0],s=document.getElementsByClassName("load_menu")[0],o=document.getElementsByClassName("fsm_frame")[0];(fsm_canvas=new FSMCanvas(o)).setString(Data.get("string"));try{a(new FSM(JSON.parse(Data.get("fsm"))))}catch(e){a(new FSM)}t.onmousedown=(()=>{n.classList.contains("menu_show")?n.parentElement.onmousedown():(t.classList.add("disabled"),n.parentElement.classList.remove("disabled"),setTimeout(()=>{n.classList.add("menu_show")},10))}),n.parentElement.onmousedown=(()=>{n.classList.remove("menu_show"),s.classList.remove("menu_show"),setTimeout(()=>{n.parentElement.classList.add("disabled"),t.classList.remove("disabled")},120)}),s.innerHTML="";for(let e in TutorialFSMS){let t=document.createElement("li");t.innerText=e,t.onmousedown=(t=>{t.stopPropagation(),a(new FSM(JSON.parse(JSON.stringify(TutorialFSMS[e]))))}),s.appendChild(t)}function a(e){fsm_canvas.setFSM(e),fsm_canvas.draw()}document.getElementById("examples").onmousedown=(e=>{e.stopPropagation(),s.classList.add("menu_show")}),document.getElementById("new").onmousedown=(e=>{e.stopPropagation(),n.parentElement.onmousedown(),a(new FSM)}),document.getElementById("load").onmousedown=(e=>{e.stopPropagation();try{a(new FSM(JSON.parse(Data.get("fsm")))),fsm_canvas.setString(Data.get("string"))}catch(e){console.log(e)}}),document.getElementById("upload").parentElement.onmousedown=(e=>{e.stopPropagation()}),document.getElementById("upload").onchange=(e=>{if(e.stopPropagation(),n.parentElement.onmousedown(),e.target.files&&e.target.files[0]){let t=e.target.files[0],n=new FileReader;n.onload=(()=>{a(new FSM(JSON.parse(n.result))),e.target.value=null}),n.readAsText(t,"utf-8")}}),document.getElementById("save").onmousedown=(e=>{e.stopPropagation(),Data.set("fsm",JSON.stringify(fsm_canvas.fsm)),Data.set("string",fsm_canvas.fsm_string.value)}),e.download="fsm.fsm",e.href=window.URL.createObjectURL(new Blob),e.onmousedown=(t=>{t.stopPropagation();let n=new Blob([JSON.stringify(fsm_canvas.fsm)],{type:"text/plain"});e.href=window.URL.createObjectURL(n),window.URL.revokeObjectURL(n)})});